#!/bin/bash

set -o noclobber
set -o errexit
set -o pipefail

set -o errtrace
set -E -o functrace

declare XICO_BASE="${XICO_BASE}${XICO_BASE:+/}"
declare BASE; BASE=$(dirname "$(realpath "$0")")
declare XTPL="${BASE}/xico.tpl.svg"

function showerr { printf '\e[31m%s\e[0m\n' "$*"; }
function showhlp { printf '\e[32m xico [-t path] | [-c char path]\n\n'; }
function makedie { showerr "$*"; exit 1; }

[ -e "$XTPL" ] || makedie "MISSING_TPL: ${XTPL}"

function fromchr {
  local c="${1:?$(showerr NO_CHAR)}"
  local o="${2:?$(showerr NO_PATH)}"
  local t="/tmp/xico_${RANDOM}.svg"
  local s=500

  echo "c :: $c"
  echo "o :: $o"
  echo "t :: $t"
  echo "s :: $s"

  sed -e "s/__XICO__/${c}/" "$XTPL" > "$t"

  inkscape -w "$s" -h "$s" "$t" -o "$o"
}

function fromtpl {
  local t="${1:?$(makedie BAD_TPL)}"

  [ -e "$t" ] || makedie TPL_NOT_FOUND

  echo "t :: $t"

  # while read -r L; do
  #
  #   CHAR="${L%% *}"
  #   DEST="${XICO_BASE}${XICO_BASE:+/}${L##* }"
  #   echo "${CHAR} : ${DEST}"
  #   xico "$CHAR" "$DEST"
  # done <"$XICO_FILE"
}


case $1 in
  -t|--template) fromtpl "${@:2}" ;;
  -c|--char    ) fromchr "${@:2}" ;;
  -h|--help    ) showhlp "${@:2}" ;;
  *            ) makedie BAD_ARG
esac

